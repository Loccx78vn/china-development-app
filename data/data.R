box::use(
  tidyverse[...],
  dplyr[...],
  tidyr[pivot_longer],
  stringr[str_remove],
  rnaturalearth[ne_states],
  stats[runif]
)

#-------------------------------------------------------------------------------
# Data for line chart:
china_data <- data.frame(
  Year = 1960:2023, 
  Per_Gov_Exp = c(
    12.44084207, 14.29842363, 12.68885257, 13.53493534, 12.68448891, 
    11.78732184, 12.08921062, 10.90604918, 11.12674784, 11.73921988, 
    10.96178313, 11.84430263, 12.00986517, 11.47924062, 12.04893315, 
    11.70396854, 12.67182894, 12.53929493, 12.89906859, 13.77944373, 
    13.75004254, 13.18256175, 13.20821892, 13.9557469, 15.07313199, 
    14.21394889, 13.85198257, 13.10862977, 12.49787459, 13.18826217, 
    13.65652116, 14.00163365, 14.44066306, 14.35274033, 14.09123646, 
    13.3081123, 13.19822745, 13.75263695, 14.94601068, 16.36569096, 
    16.83842985, 16.41343935, 16.07042441, 15.31420932, 14.62534231, 
    14.79766254, 14.82051595, 14.62676193, 14.48561439, 14.75297613, 
    14.58702058, 15.23886494, 15.75607839, 15.88401589, 15.81704465, 
    16.21788677, 16.36375556, 16.32486222, 16.53580834, 16.77051091, 
    17.13013339, 15.8081384, 16.05012775, 16.50931118),
  GDP =  c(
    59716249311, 50056685957, 47209186415, 50706614526, 59708125204, 70436008642, 
    76720005492, 72881364882, 70846276051, 79705614855, 92602634892, 99800593791, 
    1.13689E+11, 1.38543E+11, 1.44189E+11, 1.6343E+11, 1.53939E+11, 1.74936E+11, 
    1.49541E+11, 1.78281E+11, 1.91149E+11, 1.95866E+11, 2.0509E+11, 2.30687E+11, 
    2.59947E+11, 3.09488E+11, 3.00758E+11, 2.72973E+11, 3.12354E+11, 3.47768E+11, 
    3.60858E+11, 3.83373E+11, 4.26916E+11, 4.44731E+11, 5.64322E+11, 7.34485E+11, 
    8.63749E+11, 9.61602E+11, 1.02906E+12, 1.094E+12, 1.21133E+12, 1.3394E+12, 
    1.47056E+12, 1.66028E+12, 1.95535E+12, 2.28596E+12, 2.75212E+12, 3.55033E+12, 
    4.59434E+12, 5.10169E+12, 6.08719E+12, 7.55155E+12, 8.53219E+12, 9.57047E+12, 
    1.04756E+13, 1.10616E+13, 1.12333E+13, 1.23105E+13, 1.38949E+13, 1.428E+13, 
    1.46877E+13, 1.78205E+13, 1.78818E+13, 1.77948E+13)
)

china_data_2000<-china_data |> 
  filter(china_data$Year >= 2000) |> 
  mutate(Gov_Exp = GDP*Per_Gov_Exp/100)

#-------------------------------------------------------------------------------
# Data for map chart:
china_gdp <- data.frame(
  Province = c("Beijing", "Shanghai", "Jiangsu", "Fujian", "Zhejiang", "Tianjin",
               "Guangdong", "Inner Mongolia", "Hubei", "Chongqing", "Shandong", "Shaanxi",
               "Anhui", "Hunan", "Shanxi", "Xinjiang", "Hainan", "Ningxia", "Liaoning",
               "Sichuan", "Jiangxi", "Tibet", "Yunnan", "Qinghai", "Henan", "Hebei", "Jilin",
               "Guizhou", "Guangxi", "Heilongjiang", "Gansu"),
  `2023` = c(200273, 190270, 150487, 129865, 125043, 122752, 106986, 102677, 95538, 94135, 90772, 85448,
             76830, 75938, 73984, 73774, 72958, 72957, 72107, 71835, 71216, 65642, 64107, 63903, 60073,
             59332, 54695, 54172, 54005, 51563, 47867),
  `2022` = c(189988, 180536, 143466, 123618, 119022, 117925, 102217, 97433, 90358, 88953, 86143, 83030,
             72888, 71917, 73506, 69717, 67314, 70263, 68422, 67610, 69019, 58908, 60868, 60946, 58942,
             56481, 54279, 51921, 51936, 50873, 44646),
  `2021` = c(187526, 175420, 138255, 118750, 113839, 113660, 98561, 88137, 86551, 87450, 81510, 76171,
             69676, 68913, 65625, 62991, 63991, 63461, 64992, 64610, 66020, 56831, 57717, 57036, 58587,
             54181, 55148, 50476, 50137, 47199, 40976),
  `2020` = c(164158, 156803, 121333, 105106, 100738, 101068, 88521, 71640, 73687, 78294, 71825, 65867,
             62411, 62537, 51051, 53606, 55438, 55021, 58629, 58009, 57065, 52280, 52047, 50845, 54691,
             48302, 50561, 46355, 44237, 42432, 35848),
  `2015` = c(113692, 109186, 85871, 67649, 73276, 75868, 64516, 52972, 52021, 52480, 56205, 46654,
             39692, 43155, 33593, 39520, 39704, 37876, 46482, 37150, 37436, 31847, 32117, 34883, 38338,
             35994, 38128, 28547, 30900, 32759, 25946),
  `2010` = c(78307, 79396, 52787, 40773, 51110, 54053, 44669, 33262, 28359, 28084, 35599, 26388,
             21923, 24005, 25434, 24700, 23323, 24984, 31888, 21230, 21099, 17209, 16866, 20418, 23984,
             25308, 23370, 12882, 18070, 21694, 15421),
  `2000` = c(25014, 30307, 11765, 11194, 13467, 16236, 12817, 6502, 6121, 6383, 9260, 4968,
             5147, 5590, 5722, 7372, 6798, 5376, 11177, 4956, 4851, 4572, 4814, 5138, 5450, 6966,
             6646, 2759, 4652, 7515, 4163)
)

china_pop <- data.frame(
  Province = c("Mainland China", "Guangdong", "Shandong", "Henan", "Jiangsu", "Sichuan", "Hebei", "Hunan", "Zhejiang", 
               "Anhui", "Hubei", "Guangxi", "Yunnan", "Jiangxi", "Liaoning", "Fujian", "Shaanxi", "Guizhou", "Shanxi", 
               "Chongqing", "Heilongjiang", "Xinjiang", "Gansu", "Shanghai", "Inner Mongolia", "Jilin", "Beijing", "Tianjin", 
               "Hainan", "Hong Kong", "Ningxia", "Qinghai", "Tibet", "Macao"),
  Population = c(1433802600, 126570000, 101630000, 98720000, 85150000, 83740000, 74200000, 66040000, 65770000, 
                 61270000, 58440000, 50470000, 46930000, 45280000, 41970000, 41880000, 39560000, 38560000, 34810000, 
                 32130000, 30990000, 25870000, 24920000, 24750000, 24010000, 23480000, 21840000, 13630000, 10270000, 
                 7472600, 7280000, 5950000, 3640000, 677300)
)

filtered_china_pop <- china_pop[!china_pop$Province %in% c("Mainland China", "Hong Kong", "Macao"), ]


merged_data <- left_join(china_gdp, filtered_china_pop, by = "Province")

# Reshape the data for easier plotting
china_gdp_long <- merged_data %>%
  pivot_longer(cols = -c(Province, Population), names_to = "Year", values_to = "GDP") 

china_gdp_long <- china_gdp_long %>%
  mutate(Year = as.numeric(str_remove(Year, "X")))

# Fix missing value:
recode_province <- c("Tibet" = "Xizang", 
                     "Inner Mongolia" = "Inner Mongol", 
                     "Paracel Islands" = NA)

fixed_china_gdp_long <- china_gdp_long 

fixed_china_gdp_long$Province <- recode(fixed_china_gdp_long$Province, !!!recode_province)

# Load the China provinces shapefile
china_shapefile <- ne_states(country = "China", returnclass = "sf")

# Merge GDP data with the shapefile
china_gdp_sf <- merge(china_shapefile, fixed_china_gdp_long, by.x = "name", by.y = "Province") |> 
  select(name,Population,Year,GDP)
